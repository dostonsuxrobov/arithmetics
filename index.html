<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>arithmetics</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-neutral-950 text-neutral-100 antialiased">
  <div class="mx-auto max-w-3xl p-6">
    <header class="mb-6 flex items-center justify-between">
      <h1 class="text-xl font-semibold tracking-tight">arithmetics</h1>
      <div id="statsBar" class="hidden items-center gap-3 text-xs text-neutral-400">
        <div class="rounded-full bg-neutral-900 px-3 py-1 ring-1 ring-neutral-800">q: <span id="qIndex" class="text-neutral-200">0/0</span></div>
        <div class="rounded-full bg-neutral-900 px-3 py-1 ring-1 ring-neutral-800">time: <span id="timeLeft" class="text-neutral-200">0:00</span></div>
        <div class="rounded-full bg-neutral-900 px-3 py-1 ring-1 ring-neutral-800">acc: <span id="accuracy" class="text-neutral-200">0%</span></div>
      </div>
    </header>

    <!-- SETUP -->
    <section id="setup" class="rounded-2xl border border-neutral-800 bg-black p-6 shadow">
      <div class="mb-4 text-sm text-neutral-300">level, time, and number of questions.</div>
      <div class="mb-5 grid grid-cols-3 gap-2">
        <button data-level="basic" class="levelBtn h-10 rounded-xl border text-sm transition border-neutral-200 bg-neutral-100 text-neutral-900 focus:outline-none focus:ring-2 focus:ring-neutral-300">basic</button>
        <button data-level="medium" class="levelBtn h-10 rounded-xl border text-sm transition border-neutral-800 bg-neutral-900 text-neutral-200 hover:bg-neutral-800 focus:outline-none focus:ring-2 focus:ring-neutral-300">medium</button>
        <button data-level="advanced" class="levelBtn h-10 rounded-xl border text-sm transition border-neutral-800 bg-neutral-900 text-neutral-200 hover:bg-neutral-800 focus:outline-none focus:ring-2 focus:ring-neutral-300">advanced</button>
      </div>

      <div class="mb-4 grid grid-cols-1 gap-3 sm:grid-cols-2">
        <label class="flex items-center gap-3 rounded-xl border border-neutral-800 bg-neutral-950 p-3">
          <span class="w-32 text-xs text-neutral-400">duration (sec)</span>
          <input id="durationSec" type="number" min="10" max="3600" step="10" value="120" class="h-10 flex-1 rounded-lg border border-neutral-800 bg-neutral-900 px-3 text-sm text-neutral-100 focus:outline-none focus:ring-2 focus:ring-neutral-300" />
        </label>
        <label class="flex items-center gap-3 rounded-xl border border-neutral-800 bg-neutral-950 p-3">
          <span class="w-32 text-xs text-neutral-400">questions</span>
          <input id="questionTarget" type="number" min="5" max="200" step="1" value="20" class="h-10 flex-1 rounded-lg border border-neutral-800 bg-neutral-900 px-3 text-sm text-neutral-100 focus:outline-none focus:ring-2 focus:ring-neutral-300" />
        </label>
      </div>

      <div class="flex items-center justify-end gap-3">
        <button id="startBtn" class="h-10 rounded-xl border border-neutral-800 bg-neutral-900 px-5 text-sm text-neutral-100 transition hover:bg-neutral-800 focus:outline-none focus:ring-2 focus:ring-neutral-300">start</button>
      </div>

      <p class="mt-4 text-xs text-neutral-500">basic = 1‑digit ×/÷; +/− up to 2 digits.</p>
      <p class="mt-4 text-xs text-neutral-500">medium = 2‑digit ×/÷; +/− up to 3 digits.</p>
      <p class="mt-4 text-xs text-neutral-500">advanced = 3‑digit ×/÷; +/− up to 4 digits.</p>
    </section>

    <!-- PLAY -->
    <section id="play" class="hidden rounded-2xl border border-neutral-800 bg-black p-6 shadow">
      <div id="meta" class="mb-4 text-xs text-neutral-400"></div>
      <div id="question" class="mb-5 text-3xl font-semibold tracking-tight"></div>
      <form id="answerForm" class="flex items-center gap-3">
        <input id="answerInput" inputmode="numeric" autocomplete="off" placeholder="Your answer" class="h-12 flex-1 rounded-xl border border-neutral-800 bg-neutral-950 px-4 text-base text-neutral-100 placeholder-neutral-500 outline-none focus:ring-2 focus:ring-neutral-300" />
        <button class="h-12 rounded-xl border border-neutral-800 bg-neutral-900 px-5 text-sm text-neutral-100 transition hover:bg-neutral-800 focus:outline-none focus:ring-2 focus:ring-neutral-300">Submit</button>
        <button type="button" id="skipBtn" class="h-12 rounded-xl border border-neutral-800 bg-neutral-900 px-5 text-sm text-neutral-100 transition hover:bg-neutral-800 focus:outline-none focus:ring-2 focus:ring-neutral-300">Skip</button>
      </form>
      <div id="feedback" class="mt-3 text-sm font-medium text-red-500"></div>
    </section>

    <!-- DONE -->
    <section id="done" class="hidden rounded-2xl border border-neutral-800 bg-black p-6 shadow">
      <div class="mb-4 text-lg font-semibold">Summary</div>
      <div class="mb-4 grid grid-cols-2 gap-2 text-sm text-neutral-300 sm:grid-cols-4">
        <div class="rounded-lg bg-neutral-900 p-3 ring-1 ring-neutral-800">Questions: <span id="sumQ" class="text-neutral-100">0</span></div>
        <div class="rounded-lg bg-neutral-900 p-3 ring-1 ring-neutral-800">Correct: <span id="sumCorrect" class="text-neutral-100">0</span></div>
        <div class="rounded-lg bg-neutral-900 p-3 ring-1 ring-neutral-800">Accuracy: <span id="sumAcc" class="text-neutral-100">0%</span></div>
        <div class="rounded-lg bg-neutral-900 p-3 ring-1 ring-neutral-800">Time Used: <span id="sumTime" class="text-neutral-100">0:00</span></div>
      </div>
      <div class="mb-3 text-sm text-neutral-300">Mistakes with hints</div>
      <ul id="mistakeList" class="space-y-2"></ul>
      <div class="mt-5 flex items-center justify-end gap-3">
        <button id="settingsBtn" class="h-10 rounded-xl border border-neutral-800 bg-neutral-900 px-5 text-sm text-neutral-100 transition hover:bg-neutral-800 focus:outline-none focus:ring-2 focus:ring-neutral-300">Change settings</button>
        <button id="replayBtn" class="h-10 rounded-xl border border-neutral-800 bg-neutral-900 px-5 text-sm text-neutral-100 transition hover:bg-neutral-800 focus:outline-none focus:ring-2 focus:ring-neutral-300">Replay</button>
      </div>
    </section>
  </div>

  <script>
    // ---- helpers ----
    const fmt = (n) => n.toLocaleString('en');
    const pow10 = (n) => Math.pow(10, n);
    const rnd = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const parseNum = (s) => Number(String(s).replace(/[\,\s_]/g, ''));

    const LEVELS = {
      basic: { label: 'Basic', addSubDigits: 2, mulDivDigits: 1 },
      medium: { label: 'Medium', addSubDigits: 3, mulDivDigits: 2 },
      advanced: { label: 'Advanced', addSubDigits: 4, mulDivDigits: 3 },
    };

    // generators: explicit per operator for 25% each
    function buildAdd(maxDigits) {
      const upTo = pow10(maxDigits) - 1;
      const a = rnd(0, upTo), b = rnd(0, upTo);
      return { q: `${fmt(a)} + ${fmt(b)}`, a: a + b, kind: '+' };
    }
    function buildSub(maxDigits) {
      const upTo = pow10(maxDigits) - 1;
      const a = rnd(0, upTo), b = rnd(0, upTo);
      const big = Math.max(a, b), small = Math.min(a, b);
      return { q: `${fmt(big)} − ${fmt(small)}`, a: big - small, kind: '-' };
    }
    function buildMul(digits) {
      const low = pow10(digits - 1), high = pow10(digits) - 1;
      const x = rnd(low, high), y = rnd(low, high);
      return { q: `${fmt(x)} × ${fmt(y)}`, a: x * y, kind: '*' };
    }
    function buildDiv(digits) {
      const low = pow10(digits - 1), high = pow10(digits) - 1;
      const x = rnd(low, high), y = rnd(low, high);
      const divByX = Math.random() < 0.5;
      const dividend = x * y;
      return divByX
        ? { q: `${fmt(dividend)} ÷ ${fmt(x)}`, a: y, kind: '/' }
        : { q: `${fmt(dividend)} ÷ ${fmt(y)}`, a: x, kind: '/' };
    }

    function hintFor(kind) {
      switch (kind) {
        case '+': return 'Line up digits. Add column-wise. Carry when a column ≥ 10.';
        case '-': return 'Line up digits. Borrow from the next column if needed. Keep result non-negative.';
        case '*': return 'Use place value. Multiply per digit. Add partial products. Track carries.';
        case '/': return 'Use long division. These divide exactly. Bring down digits each step.';
      }
    }

    const state = {
      level: 'basic',
      qTarget: 20,
      durationSec: 120,
      idx: 0,
      tries: 0,
      correct: 0,
      streak: 0,
      best: 0,
      mistakes: [],
      timeLeft: 0,
      timerId: null,
      problem: null,
    };

    // DOM refs
    const el = (id) => document.getElementById(id);
    const setup = el('setup');
    const play = el('play');
    const done = el('done');

    const statsBar = document.getElementById('statsBar');
    const qIndex = el('qIndex');
    const timeLeft = el('timeLeft');
    const accuracy = el('accuracy');

    const meta = el('meta');
    const question = el('question');
    const answerForm = el('answerForm');
    const answerInput = el('answerInput');
    const feedback = el('feedback');

    // level selector
    document.querySelectorAll('.levelBtn').forEach((btn) => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.levelBtn').forEach(b => b.className = b.className
          .replace('border-neutral-200 bg-neutral-100 text-neutral-900', 'border-neutral-800 bg-neutral-900 text-neutral-200')); 
        btn.className = btn.className
          .replace('border-neutral-800 bg-neutral-900 text-neutral-200', 'border-neutral-200 bg-neutral-100 text-neutral-900');
        state.level = btn.dataset.level;
      });
    });

    function formatClock(s) {
      return Math.floor(s / 60) + ':' + String(s % 60).padStart(2, '0');
    }

    function updateStatsBar() {
      qIndex.textContent = `${state.idx}/${state.qTarget}`;
      timeLeft.textContent = formatClock(state.timeLeft);
      const acc = state.tries ? Math.round((state.correct / state.tries) * 100) : 0;
      accuracy.textContent = acc + '%';
    }

    function nextProblem() {
      const spec = LEVELS[state.level];
      const pick = rnd(0, 3); // 0..3 => +, -, *, /
      let p;
      if (pick === 0) p = buildAdd(spec.addSubDigits);
      else if (pick === 1) p = buildSub(spec.addSubDigits);
      else if (pick === 2) p = buildMul(spec.mulDivDigits);
      else p = buildDiv(spec.mulDivDigits);
      state.problem = p;
      meta.textContent =
        p.kind === '+' || p.kind === '-' ? `Add/Sub up to ${spec.addSubDigits} digits` : `${spec.mulDivDigits}-digit ${p.kind === '*' ? '×' : '÷'}${p.kind === '/' ? ' (clean)' : ''}`;
      question.textContent = p.q;
      answerInput.value = '';
      answerInput.focus();
    }

    function endIfNeeded() {
      if (state.idx >= state.qTarget) endSession();
    }

    function endSession() {
      clearInterval(state.timerId);
      statsBar.classList.add('hidden');
      play.classList.add('hidden');
      setup.classList.add('hidden');
      done.classList.remove('hidden');

      el('sumQ').textContent = state.idx;
      el('sumCorrect').textContent = state.correct;
      const acc = state.tries ? Math.round((state.correct / state.tries) * 100) : 0;
      el('sumAcc').textContent = acc + '%';
      el('sumTime').textContent = formatClock(state.durationSec - state.timeLeft);

      const list = el('mistakeList');
      list.innerHTML = '';
      if (state.mistakes.length === 0) {
        const li = document.createElement('li');
        li.className = 'text-sm text-neutral-400';
        li.textContent = 'No mistakes.';
        list.appendChild(li);
      } else {
        state.mistakes.forEach((m) => {
          const li = document.createElement('li');
          li.className = 'rounded-xl border border-neutral-800 bg-neutral-900 p-3 text-sm';
          li.innerHTML =
            `<div class="mb-1 font-medium text-neutral-200">#${m.idx}: ${m.problem}</div>` +
            `<div class="mb-1 text-red-500">Your answer: ${m.your}</div>` +
            `<div class="mb-1 text-neutral-300">Correct: ${m.correct}</div>` +
            `<div class="text-xs text-neutral-400">Hint: ${hintFor(m.kind)}</div>`;
          list.appendChild(li);
        });
      }
    }

    function startSession() {
      // read inputs
      state.qTarget = Math.max(1, Math.min(200, Number(document.getElementById('questionTarget').value) || 20));
      state.durationSec = Math.max(10, Math.min(3600, Number(document.getElementById('durationSec').value) || 120));

      // reset stats
      state.idx = 0;
      state.tries = 0;
      state.correct = 0;
      state.streak = 0;
      state.best = 0;
      state.mistakes = [];
      state.timeLeft = state.durationSec;

      // swap UI
      setup.classList.add('hidden');
      done.classList.add('hidden');
      play.classList.remove('hidden');
      statsBar.classList.remove('hidden');

      // timer
      clearInterval(state.timerId);
      state.timerId = setInterval(() => {
        state.timeLeft -= 1;
        if (state.timeLeft <= 0) {
          state.timeLeft = 0;
          updateStatsBar();
          endSession();
          return;
        }
        updateStatsBar();
      }, 1000);

      updateStatsBar();
      feedback.textContent = '';
      nextProblem();
    }

    function recordWrong(guessRaw, p) {
      state.mistakes.push({ idx: state.idx + 1, problem: p.q, your: guessRaw, correct: fmt(p.a), kind: p.kind });
    }

    // events
    document.getElementById('startBtn').addEventListener('click', startSession);
    document.getElementById('replayBtn').addEventListener('click', startSession);
    document.getElementById('settingsBtn').addEventListener('click', () => {
      done.classList.add('hidden');
      setup.classList.remove('hidden');
    });

    document.getElementById('skipBtn').addEventListener('click', () => {
      const p = state.problem; if (!p) return;
      state.tries += 1; state.streak = 0; state.idx += 1; recordWrong('(skipped)', p);
      updateStatsBar();
      nextProblem();
      endIfNeeded();
      feedback.textContent = '';
    });

    answerForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const p = state.problem; if (!p) return;
      const guessRaw = answerInput.value.trim();
      if (guessRaw === '') return;
      const guess = parseNum(guessRaw);
      const correct = guess === p.a;

      state.tries += 1;
      if (correct) { state.correct += 1; state.streak += 1; state.best = Math.max(state.best, state.streak); }
      else { state.streak = 0; recordWrong(guessRaw, p); }

      state.idx += 1;
      updateStatsBar();

      if (!correct) {
        feedback.textContent = `Wrong. Correct: ${fmt(p.a)}`;
        setTimeout(() => { feedback.textContent = ''; nextProblem(); endIfNeeded(); }, 700);
      } else {
        feedback.textContent = '';
        nextProblem();
        endIfNeeded();
      }
    });

    // keyboard helpers
    answerInput.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') { answerInput.value = ''; }
    });
  </script>
</body>
</html>
