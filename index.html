<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>arithmetics</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      min-height: 100vh;
      background: #0a0a0a;
      color: #fafafa;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      -webkit-font-smoothing: antialiased;
    }
    .container { max-width: 48rem; margin: 0 auto; padding: 1rem; }
    @media (min-width: 640px) { .container { padding: 1.5rem; } }
    
    header { margin-bottom: 1.5rem; }
    h1 { font-size: 1.25rem; font-weight: 600; letter-spacing: -0.025em; margin-bottom: 0.5rem; }
    
    #statsBar { display: none; flex-wrap: wrap; gap: 0.75rem; font-size: 0.75rem; color: #a3a3a3; }
    #statsBar.show { display: flex; }
    .stat-pill {
      background: #171717;
      border-radius: 9999px;
      padding: 0.25rem 0.75rem;
      border: 1px solid #262626;
    }
    .stat-pill span { color: #e5e5e5; }
    
    section {
      background: #000;
      border: 1px solid #262626;
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
    }
    section.hidden { display: none; }
    
    .section-title { font-size: 0.875rem; color: #d4d4d4; margin-bottom: 1rem; }
    
    .level-btns {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
      margin-bottom: 1.25rem;
    }
    .level-btn {
      height: 2.5rem;
      border-radius: 0.75rem;
      font-size: 0.875rem;
      border: 1px solid #262626;
      background: #171717;
      color: #e5e5e5;
      cursor: pointer;
      transition: all 0.2s;
    }
    .level-btn:hover { background: #262626; }
    .level-btn:focus { outline: none; box-shadow: 0 0 0 2px #404040; }
    .level-btn.active {
      border-color: #e5e5e5;
      background: #fafafa;
      color: #171717;
    }
    
    .inputs { display: grid; gap: 0.75rem; margin-bottom: 1rem; }
    @media (min-width: 640px) { .inputs { grid-template-columns: repeat(2, 1fr); } }
    
    .input-wrapper {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      background: #0a0a0a;
      border: 1px solid #262626;
      border-radius: 0.75rem;
      padding: 0.75rem;
    }
    @media (min-width: 640px) {
      .input-wrapper { flex-direction: row; align-items: center; }
    }
    .input-label {
      font-size: 0.75rem;
      color: #a3a3a3;
    }
    @media (min-width: 640px) { .input-label { width: 8rem; } }
    
    input[type="number"] {
      height: 2.5rem;
      flex: 1;
      border-radius: 0.5rem;
      border: 1px solid #262626;
      background: #171717;
      padding: 0 0.75rem;
      font-size: 0.875rem;
      color: #fafafa;
    }
    input[type="number"]:focus {
      outline: none;
      box-shadow: 0 0 0 2px #404040;
    }
    
    .btn-row {
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
    }
    button {
      height: 2.5rem;
      border-radius: 0.75rem;
      border: 1px solid #262626;
      background: #171717;
      color: #fafafa;
      padding: 0 1.25rem;
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:hover { background: #262626; }
    button:focus { outline: none; box-shadow: 0 0 0 2px #404040; }
    
    .hint { font-size: 0.75rem; color: #737373; margin-top: 1rem; }
    
    #meta { font-size: 0.75rem; color: #a3a3a3; margin-bottom: 1rem; }
    #question {
      font-size: 1.875rem;
      font-weight: 600;
      letter-spacing: -0.025em;
      margin-bottom: 1.25rem;
      word-wrap: break-word;
    }
    
    #answerForm {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    @media (min-width: 640px) {
      #answerForm { flex-direction: row; align-items: center; }
    }
    
    #answerInput {
      height: 3rem;
      width: 100%;
      border-radius: 0.75rem;
      border: 1px solid #262626;
      background: #0a0a0a;
      padding: 0 1rem;
      font-size: 1rem;
      color: #fafafa;
    }
    @media (min-width: 640px) {
      #answerInput { flex: 1; }
    }
    #answerInput::placeholder { color: #737373; }
    #answerInput:focus { outline: none; box-shadow: 0 0 0 2px #404040; }
    
    .btn-group {
      display: flex;
      gap: 0.75rem;
    }
    .btn-group button { flex: 1; height: 3rem; }
    @media (min-width: 640px) {
      .btn-group button { flex: none; }
    }
    
    #feedback { margin-top: 0.75rem; font-size: 0.875rem; font-weight: 500; color: #ef4444; }
    
    .summary-title { font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; }
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
      margin-bottom: 1rem;
      font-size: 0.875rem;
      color: #d4d4d4;
    }
    @media (min-width: 640px) {
      .summary-grid { grid-template-columns: repeat(4, 1fr); }
    }
    .summary-card {
      background: #171717;
      border: 1px solid #262626;
      border-radius: 0.5rem;
      padding: 0.75rem;
    }
    .summary-card span { color: #fafafa; }
    
    .mistakes-title { font-size: 0.875rem; color: #d4d4d4; margin-bottom: 0.75rem; }
    #mistakeList { list-style: none; }
    #mistakeList li {
      background: #171717;
      border: 1px solid #262626;
      border-radius: 0.75rem;
      padding: 0.75rem;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }
    #mistakeList li > div { margin-bottom: 0.25rem; }
    #mistakeList .mistake-title { font-weight: 500; color: #e5e5e5; word-wrap: break-word; }
    #mistakeList .mistake-wrong { color: #ef4444; }
    #mistakeList .mistake-correct { color: #d4d4d4; }
    #mistakeList .mistake-hint { font-size: 0.75rem; color: #a3a3a3; margin-bottom: 0; }
    
    .bottom-btns {
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      gap: 0.75rem;
      margin-top: 1.25rem;
    }
    @media (min-width: 640px) {
      .bottom-btns { flex-direction: row; }
      .bottom-btns button { width: auto; }
    }
    .bottom-btns button { width: 100%; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>arithmetics</h1>
      <div id="statsBar">
        <div class="stat-pill">q: <span id="qIndex">0/0</span></div>
        <div class="stat-pill">time: <span id="timeLeft">0:00</span></div>
        <div class="stat-pill">acc: <span id="accuracy">0%</span></div>
      </div>
    </header>

    <!-- SETUP -->
    <section id="setup">
      <div class="section-title">level, time, and number of questions.</div>
      <div class="level-btns">
        <button data-level="basic" class="level-btn active">basic</button>
        <button data-level="medium" class="level-btn">medium</button>
        <button data-level="advanced" class="level-btn">advanced</button>
      </div>

      <div class="inputs">
        <div class="input-wrapper">
          <span class="input-label">duration (sec)</span>
          <input id="durationSec" type="number" min="10" max="3600" step="10" value="120" />
        </div>
        <div class="input-wrapper">
          <span class="input-label">questions</span>
          <input id="questionTarget" type="number" min="5" max="200" step="1" value="20" />
        </div>
      </div>

      <div class="btn-row">
        <button id="startBtn">start</button>
      </div>

      <p class="hint">basic = 1‑digit ×/÷; +/− up to 2 digits.</p>
      <p class="hint">medium = 2‑digit ×/÷; +/− up to 3 digits.</p>
      <p class="hint">advanced = 3‑digit ×/÷; +/− up to 4 digits.</p>
    </section>

    <!-- PLAY -->
    <section id="play" class="hidden">
      <div id="meta"></div>
      <div id="question"></div>
      <form id="answerForm">
        <input id="answerInput" inputmode="numeric" autocomplete="off" placeholder="Your answer" />
        <div class="btn-group">
          <button type="submit">Submit</button>
          <button type="button" id="skipBtn">Skip</button>
        </div>
      </form>
      <div id="feedback"></div>
    </section>

    <!-- DONE -->
    <section id="done" class="hidden">
      <div class="summary-title">summary</div>
      <div class="summary-grid">
        <div class="summary-card">questions: <span id="sumQ">0</span></div>
        <div class="summary-card">correct: <span id="sumCorrect">0</span></div>
        <div class="summary-card">accuracy: <span id="sumAcc">0%</span></div>
        <div class="summary-card">time used: <span id="sumTime">0:00</span></div>
      </div>
      <div class="mistakes-title">mistakes with hints</div>
      <ul id="mistakeList"></ul>
      <div class="bottom-btns">
        <button id="settingsBtn">change settings</button>
        <button id="replayBtn">replay</button>
      </div>
    </section>
  </div>

  <script>
    // ---- helpers ----
    const fmt = (n) => n.toLocaleString('en');
    const pow10 = (n) => Math.pow(10, n);
    const rnd = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
    const parseNum = (s) => Number(String(s).replace(/[\,\s_]/g, ''));

    const LEVELS = {
      basic: { label: 'basic', addSubDigits: 2, mulDivDigits: 1 },
      medium: { label: 'medium', addSubDigits: 3, mulDivDigits: 2 },
      advanced: { label: 'advanced', addSubDigits: 4, mulDivDigits: 3 },
    };

    function buildAdd(maxDigits) {
      const upTo = pow10(maxDigits) - 1;
      const a = rnd(0, upTo), b = rnd(0, upTo);
      return { q: `${fmt(a)} + ${fmt(b)}`, a: a + b, kind: '+' };
    }
    function buildSub(maxDigits) {
      const upTo = pow10(maxDigits) - 1;
      const a = rnd(0, upTo), b = rnd(0, upTo);
      const big = Math.max(a, b), small = Math.min(a, b);
      return { q: `${fmt(big)} − ${fmt(small)}`, a: big - small, kind: '-' };
    }
    function buildMul(digits) {
      const low = pow10(digits - 1), high = pow10(digits) - 1;
      const x = rnd(low, high), y = rnd(low, high);
      return { q: `${fmt(x)} × ${fmt(y)}`, a: x * y, kind: '*' };
    }
    function buildDiv(digits) {
      const low = pow10(digits - 1), high = pow10(digits) - 1;
      const x = rnd(low, high), y = rnd(low, high);
      const divByX = Math.random() < 0.5;
      const dividend = x * y;
      return divByX
        ? { q: `${fmt(dividend)} ÷ ${fmt(x)}`, a: y, kind: '/' }
        : { q: `${fmt(dividend)} ÷ ${fmt(y)}`, a: x, kind: '/' };
    }

    function hintFor(kind) {
      switch (kind) {
        case '+': return 'line up digits. add column-wise. carry when a column ≥ 10.';
        case '-': return 'line up digits. borrow from the next column if needed. keep result non-negative.';
        case '*': return 'use place value. multiply per digit. add partial products. track carries.';
        case '/': return 'use long division. these divide exactly. bring down digits each step.';
      }
    }

    const state = {
      level: 'basic',
      qTarget: 20,
      durationSec: 120,
      idx: 0,
      tries: 0,
      correct: 0,
      streak: 0,
      best: 0,
      mistakes: [],
      timeLeft: 0,
      timerId: null,
      problem: null,
    };

    const el = (id) => document.getElementById(id);
    const setup = el('setup');
    const play = el('play');
    const done = el('done');
    const statsBar = el('statsBar');
    const qIndex = el('qIndex');
    const timeLeft = el('timeLeft');
    const accuracy = el('accuracy');
    const meta = el('meta');
    const question = el('question');
    const answerForm = el('answerForm');
    const answerInput = el('answerInput');
    const feedback = el('feedback');

    document.querySelectorAll('.level-btn').forEach((btn) => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.level = btn.dataset.level;
      });
    });

    function formatClock(s) {
      return Math.floor(s / 60) + ':' + String(s % 60).padStart(2, '0');
    }

    function updateStatsBar() {
      qIndex.textContent = `${state.idx}/${state.qTarget}`;
      timeLeft.textContent = formatClock(state.timeLeft);
      const acc = state.tries ? Math.round((state.correct / state.tries) * 100) : 0;
      accuracy.textContent = acc + '%';
    }

    function nextProblem() {
      const spec = LEVELS[state.level];
      const pick = rnd(0, 3);
      let p;
      if (pick === 0) p = buildAdd(spec.addSubDigits);
      else if (pick === 1) p = buildSub(spec.addSubDigits);
      else if (pick === 2) p = buildMul(spec.mulDivDigits);
      else p = buildDiv(spec.mulDivDigits);
      state.problem = p;
      meta.textContent =
        p.kind === '+' || p.kind === '-' ? `add/sub up to ${spec.addSubDigits} digits` : `${spec.mulDivDigits}-digit ${p.kind === '*' ? '×' : '÷'}${p.kind === '/' ? ' (clean)' : ''}`;
      question.textContent = p.q;
      answerInput.value = '';
      answerInput.focus();
    }

    function endIfNeeded() {
      if (state.idx >= state.qTarget) endSession();
    }

    function endSession() {
      clearInterval(state.timerId);
      statsBar.classList.remove('show');
      play.classList.add('hidden');
      setup.classList.add('hidden');
      done.classList.remove('hidden');

      el('sumQ').textContent = state.idx;
      el('sumCorrect').textContent = state.correct;
      const acc = state.tries ? Math.round((state.correct / state.tries) * 100) : 0;
      el('sumAcc').textContent = acc + '%';
      el('sumTime').textContent = formatClock(state.durationSec - state.timeLeft);

      const list = el('mistakeList');
      list.innerHTML = '';
      if (state.mistakes.length === 0) {
        const li = document.createElement('li');
        li.style.color = '#a3a3a3';
        li.textContent = 'no mistakes.';
        list.appendChild(li);
      } else {
        state.mistakes.forEach((m) => {
          const li = document.createElement('li');
          li.innerHTML =
            `<div class="mistake-title">#${m.idx}: ${m.problem}</div>` +
            `<div class="mistake-wrong">your answer: ${m.your}</div>` +
            `<div class="mistake-correct">correct: ${m.correct}</div>` +
            `<div class="mistake-hint">hint: ${hintFor(m.kind)}</div>`;
          list.appendChild(li);
        });
      }
    }

    function startSession() {
      state.qTarget = Math.max(1, Math.min(200, Number(el('questionTarget').value) || 20));
      state.durationSec = Math.max(10, Math.min(3600, Number(el('durationSec').value) || 120));
      state.idx = 0;
      state.tries = 0;
      state.correct = 0;
      state.streak = 0;
      state.best = 0;
      state.mistakes = [];
      state.timeLeft = state.durationSec;

      setup.classList.add('hidden');
      done.classList.add('hidden');
      play.classList.remove('hidden');
      statsBar.classList.add('show');

      clearInterval(state.timerId);
      state.timerId = setInterval(() => {
        state.timeLeft -= 1;
        if (state.timeLeft <= 0) {
          state.timeLeft = 0;
          updateStatsBar();
          endSession();
          return;
        }
        updateStatsBar();
      }, 1000);

      updateStatsBar();
      feedback.textContent = '';
      nextProblem();
    }

    function recordWrong(guessRaw, p) {
      state.mistakes.push({ idx: state.idx + 1, problem: p.q, your: guessRaw, correct: fmt(p.a), kind: p.kind });
    }

    el('startBtn').addEventListener('click', startSession);
    el('replayBtn').addEventListener('click', startSession);
    el('settingsBtn').addEventListener('click', () => {
      done.classList.add('hidden');
      setup.classList.remove('hidden');
    });

    el('skipBtn').addEventListener('click', () => {
      const p = state.problem; if (!p) return;
      state.tries += 1; state.streak = 0; state.idx += 1; recordWrong('(skipped)', p);
      updateStatsBar();
      nextProblem();
      endIfNeeded();
      feedback.textContent = '';
    });

    answerForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const p = state.problem; if (!p) return;
      const guessRaw = answerInput.value.trim();
      if (guessRaw === '') return;
      const guess = parseNum(guessRaw);
      const correct = guess === p.a;

      state.tries += 1;
      if (correct) { state.correct += 1; state.streak += 1; state.best = Math.max(state.best, state.streak); }
      else { state.streak = 0; recordWrong(guessRaw, p); }

      state.idx += 1;
      updateStatsBar();

      if (!correct) {
        feedback.textContent = `Wrong. Correct: ${fmt(p.a)}`;
        setTimeout(() => { feedback.textContent = ''; nextProblem(); endIfNeeded(); }, 700);
      } else {
        feedback.textContent = '';
        nextProblem();
        endIfNeeded();
      }
    });

    answerInput.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') { answerInput.value = ''; }
    });
  </script>
</body>
</html>
